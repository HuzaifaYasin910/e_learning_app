{% extends 'navs-studs.html' %} {% block navs %} <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvas"><div class="offcanvas-header bg-light"><h5 class="offcanvas-title">Modules</h5><button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button></div><div class="offcanvas-body p-0"><ul class="list-group">{% for module in course.module_set.all %}{% if module in student.completed_modules.all %} <li class="list-group-item"><i class="fa fa-check-circle fs-5 text-success"></i><a href="{% url 'students:course_class' module.id course.id %}"><span>{{ module.title}}</span></a></li>{% else %} <li class="list-group-item"><i class="fa fa-check-circle-o fs-5"></i><a href="{% url 'students:course_class' module.id course.id %}"><span>{{ module.title}}</span></a></li>{% endif %}{% endfor %} </ul></div></div><div id="customAlert" class="custom-alert"><span class="alert-message"></span><button class="close-alert" onclick="closeCustomAlert()">&times;</button></div>{% if is_video %} <div id="content" class="white"><div class="container py-5 px-5"><video class="video-element w-100 h-auto mt-4" width="560" height="315" controls poster="{{course.image.url}}" ><source src="{{module.file.url}}" type="video/mp4" /></video><div class="card mt-5 mb-2" style="border-style: none;"><div class="card-body" style="border-radius: 10px;border: 2px solid rgba(0,0,0,0.9) ;"><h4 class="card-title Alatsi fc-dark-l m-0">{{module.title}}</h4><h4 class="small fw-bold mt-3">Course Progress<span id="student_progress" class="float-end">{{student_progress}}%</span></h4><div class="progress progress-sm mb-3"><div class="progress-bar bg-success" id="progress-bar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:{{student_progress}}%"></div></div></div></div>{% if module.description %} <h3 class="Alatsi fc-dark-l">Description</h3><p class="fs-5 fw-bold mb-4">{{module.description}}</p>{% endif %} <a class="btn btn-primary" role="button" data-bs-toggle="offcanvas" href="#offcanvas"><i class="fa fa-list-ul"></i>&nbsp;List</a></div><script src="https://code.jquery.com/jquery-3.7.0.min.js"></script><script>const video=document.querySelector(".video-element"); const completionThreshold=90; let videoDuration=NaN; let isVideoCompleted=false; video.addEventListener("loadedmetadata", function (){ videoDuration=video.duration}); video.addEventListener("play", function (){ if (!isNaN(videoDuration) && !isVideoCompleted){ video.addEventListener("timeupdate", trackProgress)}}); video.addEventListener("pause", function (){ video.removeEventListener("timeupdate", trackProgress)}); function trackProgress(){ const currentTime=video.currentTime; const percentComplete=(currentTime / videoDuration) * 100; if (percentComplete >=completionThreshold && !isVideoCompleted){ isVideoCompleted=true; markModuleAsCompleted()}} function markModuleAsCompleted(){ $.ajax({ type: "POST", url: "{% url 'students:mark_module_completed'%}", async: true, dataType: 'json', data:{course_id : "{{course.id}}",module_id: "{{module.id}}", csrfmiddlewaretoken: "{{csrf_token}}"}, success: function (e){ if(e.student_progress_percentage===undefined){ console.log('undefined')} else{ showCustomAlert("Module Completed"); var progress=document.getElementById("progress-bar"); var progress_percentage=document.getElementById("student_progress"); progress_percentage.textContent=e.student_progress_percentage + '%'; progress.style.width=e.student_progress_percentage + '%'}}, error: function (xhr, textStatus, errorThrown){ console.log("Error status: " + textStatus); console.log("Error thrown: " + errorThrown); console.log(xhr.responseText); showCustomAlert("Module Completed - Error")}})} function showCustomAlert(message){ var customAlert=document.getElementById("customAlert"); var alertMessage=customAlert.querySelector(".alert-message"); alertMessage.textContent=message; customAlert.style.display="block"} function closeCustomAlert(){ document.getElementById("customAlert").style.display="none"} </script>{% else %} <div id="content"><div class="container py-5 px-5 vh-100"><div class="card my-5" style="border-style: none;"><div class="card-body px-4" style="border-radius: 29px;border: 2px solid rgba(0,0,0,0.9) ;"><h4 class="card-title my-3 Alatsi fc-dark-l">RESOURCES</h4><p class="card-text fc-dark-l">Download Resources ({{module.title}})</p><a class="card-link " href="{{module.file.url}}"><i class="fas fa-cloud-download-alt fs-3"></i></a></div></div>{% if module.descriptio%} <h3 class="Alatsi fc-dark-l">Description</h3><p class="fs-5 fw-bold mb-5">{{module.description}}</p>{% endif %} <a class="btn btn-primary" role="button" data-bs-toggle="offcanvas" href="#offcanvas"><i class="fa fa-list-ul"></i>&nbsp;List</a></div></div><script src="https://code.jquery.com/jquery-3.7.0.min.js"></script><script>$(document).ready(function (){ markModuleAsCompleted()}); function markModuleAsCompleted(){ $.ajax({ type: "POST", url: "{% url 'students:mark_module_completed'%}", async: true, dataType:'json', data:{ course_id : "{{course.id}}", module_id: "{{module.id}}", csrfmiddlewaretoken: "{{csrf_token}}"},})} </script>{% endif %} {% endblock %}